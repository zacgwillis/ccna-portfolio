# Native VLAN Mismatch / Untagged Leakage

## Objective
Generate ARP broadcasts into undesired VLANs due to a native VLAN trunk mismatch

## Topology
![GNS3 Topology](./screenshots/VLAN%20Hopping%20Lab.png)

## Initial Setup / Baseline
* Assign appropriate IP addresses for end-users in their respective VLAN
* Create VLANs 10 & 20 on both switches w/ their respective names
* Configure appropriate access ports for both SW1 & SW2, then configure a dot1q trunk between them  
[SW1 Config](./config/SW1-config.txt)  
[SW2 Config](./config/SW2-config.txt)

## Misconfiguration Introduced
* On SW1, configure the native VLAN as VLAN 10
* On SW2, configure the native VLAN as VLAN 20  

## Procedure / Demonstration
From PC1, ping any nonexistent IP inside its own subnet - this will trigger an ARP broadcast. Since SW1 has a native VLAN of 10, the ARP broadcast generated by PC1's ping, will cross the trunk, untagged, w/ no additional VLAN header   

SW2 receives this untagged frame, assumes the frame is meant for its own configured native VLAN (VLAN 20 in this case) and will forward that frame into VLAN 20 (VLAN Hopping). This also works in reverse by intitiating a ping from PC2 (symmetrical)

## Evidence of Leakage

#### VLAN 10 ARP Broadcast "Hopping" into VLAN 20  
![VLAN Hopping / ARP Broadcast Leak into VLAN 20](./screenshots/SW2-PC2%20link%20VLAN%20leakage.png)

## Verification
CDP Syslog Warning Message  
`*Feb  8 00:03:30.353: %CDP-4-NATIVE_VLAN_MISMATCH: Native VLAN mismatch discovered on Ethernet0/1 (20), with SW1 Ethernet0/0 (10).`  

`show mac address-table [dynamic]`  
![show mac address-table [dynamic output]](./screenshots/show%20mac%20address-table%20dynamic%20output.png)

To verify a trunks native VLAN:  
`show interfaces [e0/1] switchport`  
`show interfaces trunk`

## Mitigation / Best Practices
* Match native VLANs on both ends of the trunk  
* Use an unused VLAN as native on all trunks  
* Avoid VLAN 1 entirely for native or data  

## Notes
* Symmetric hopping is easier to illustrate bidirectional leakage using existing PCs  
* Asymmetric mismatches are more common & stealthier - detected mainly via CDP logs/CLI, not obvious user impact
